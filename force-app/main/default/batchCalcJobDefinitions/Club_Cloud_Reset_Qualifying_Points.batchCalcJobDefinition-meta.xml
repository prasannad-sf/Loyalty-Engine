<?xml version="1.0" encoding="UTF-8"?>
<BatchCalcJobDefinition xmlns="http://soap.sforce.com/2006/04/metadata">
    <dataSpaceApiName>default</dataSpaceApiName>
    <datasources>
        <description>The loyalty program is used as a data source for calculating points to reset.</description>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Id</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Name</name>
        </fields>
        <label>Loyalty Program</label>
        <name>LoyaltyProgram</name>
        <sourceName>LoyaltyProgram</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The loyalty tier group is used as a data source for calculating points to reset.</description>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Id</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Name</name>
        </fields>
        <fields>
            <dataType>Date</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>QpResetDate</name>
        </fields>
        <fields>
            <dataType>Numeric</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>QpResetFrequency</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>QpResetPeriod</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>TierModel</name>
        </fields>
        <label>Loyalty Tier Group</label>
        <name>LoyaltyTierGroup</name>
        <sourceName>LoyaltyTierGroup</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The loyalty program currency is used as a data source for calculating points to reset.</description>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>CurrencyType</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Id</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>LoyaltyProgramId</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>LoyaltyTierGroupId</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Name</name>
        </fields>
        <label>Loyalty Program Currency</label>
        <name>LoyaltyProgramCurrency</name>
        <sourceName>LoyaltyProgramCurrency</sourceName>
        <type>StandardObject</type>
    </datasources>
    <datasources>
        <description>The loyalty member currency is used as a data source for calculating points to reset.</description>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Id</name>
        </fields>
        <fields>
            <dataType>Date</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>LastResetDate</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>LoyaltyMemberId</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>LoyaltyProgramCurrencyId</name>
        </fields>
        <fields>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>Name</name>
        </fields>
        <fields>
            <dataType>Date</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>NextResetDate</name>
        </fields>
        <fields>
            <dataType>Numeric</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>TotalPointsExpired</name>
        </fields>
        <fields>
            <dataType>Numeric</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>TotalEscrowRolloverPoints</name>
        </fields>
        <fields>
            <dataType>Numeric</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>TotalPointsAccrued</name>
        </fields>
        <fields>
            <dataType>Numeric</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>TotalPointsRedeemed</name>
        </fields>
        <fields>
            <dataType>Numeric</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>BalanceBeforeReset</name>
        </fields>
        <fields>
            <dataType>Numeric</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>PointsBalBeforeSecondLastReset</name>
        </fields>
        <fields>
            <alias>MemberStatus</alias>
            <dataType>Text</dataType>
            <isPrimaryKey>false</isPrimaryKey>
            <name>LoyaltyMember.MemberStatus</name>
        </fields>
        <label>Loyalty Member Currency</label>
        <name>LoyaltyMemberCurrency</name>
        <sourceName>LoyaltyMemberCurrency</sourceName>
        <type>StandardObject</type>
    </datasources>
    <definitionRunMode>Batch</definitionRunMode>
    <description>Calculates and resets qualifying points balance to zero for members based on the tier model.</description>
    <executionPlatformType>CRMA</executionPlatformType>
    <filters>
        <criteria>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>MemberStatus</sourceFieldName>
            <value>Active</value>
        </criteria>
        <description>Filters Loyalty Program Member records that have the value of the Status field set as Active.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Active Loyalty Program Member</label>
        <name>FilterActiveLoyaltyProgramMember</name>
        <sourceName>LoyaltyMemberCurrency</sourceName>
    </filters>
    <filters>
        <criteria>
            <inputVariable>LoyaltyProgramName</inputVariable>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>LoyaltyProgramName</sourceFieldName>
        </criteria>
        <description>Filters the loyalty member currency records from the source node based on the program name.</description>
        <filterCondition>1</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Filter Currency Records By Program</label>
        <name>FilterCurrencyRecordsByProgram</name>
        <sourceName>LMCAndLPCPlusLP</sourceName>
    </filters>
    <filters>
        <criteria>
            <inputVariable>TierGroupName</inputVariable>
            <operator>Equals</operator>
            <sequence>1</sequence>
            <sourceFieldName>TierGroupName</sourceFieldName>
        </criteria>
        <criteria>
            <inputVariable>QualifyingPointsResetDate</inputVariable>
            <operator>LessThan</operator>
            <sequence>2</sequence>
            <sourceFieldName>NextResetDate</sourceFieldName>
        </criteria>
        <criteria>
            <operator>Equals</operator>
            <sequence>3</sequence>
            <sourceFieldName>CurrencyType</sourceFieldName>
            <value>Qualifying</value>
        </criteria>
        <description>Filters the member currency records to be reset by tier group, currency type and reset date.</description>
        <filterCondition>1 AND 2 AND 3</filterCondition>
        <isDynamicFilter>false</isDynamicFilter>
        <label>Currency Records To Reset</label>
        <name>CurrencyRecordsToReset</name>
        <sourceName>FilterMemberCurrencyPlusLPCPlusLTG</sourceName>
    </filters>
    <isTemplate>false</isTemplate>
    <joins>
        <description>Adds the currency type to each loyalty member currency records.</description>
        <fields>
            <alias>ProgramCurrencyId</alias>
            <sourceFieldName>LoyaltyProgramCurrencyId</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyMemberId</alias>
            <sourceFieldName>LoyaltyMemberId</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>NextResetDate</alias>
            <sourceFieldName>NextResetDate</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>LastResetDate</alias>
            <sourceFieldName>LastResetDate</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>TotalPointsExpired</alias>
            <sourceFieldName>TotalPointsExpired</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>TotalEscrowRolloverPoints</alias>
            <sourceFieldName>TotalEscrowRolloverPoints</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>TotalPointsAccrued</alias>
            <sourceFieldName>TotalPointsAccrued</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>TotalPointsRedeemed</alias>
            <sourceFieldName>TotalPointsRedeemed</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>BalanceBeforeReset</alias>
            <sourceFieldName>BalanceBeforeReset</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>PointsBalBeforeSecondLastReset</alias>
            <sourceFieldName>PointsBalBeforeSecondLastReset</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>MemberCurrencyId</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>FilterActiveLoyaltyProgramMember</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyTierGroupId</alias>
            <sourceFieldName>LoyaltyTierGroupId</sourceFieldName>
            <sourceName>LoyaltyProgramCurrency</sourceName>
        </fields>
        <fields>
            <alias>CurrencyType</alias>
            <sourceFieldName>CurrencyType</sourceFieldName>
            <sourceName>LoyaltyProgramCurrency</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyProgramId</alias>
            <sourceFieldName>LoyaltyProgramId</sourceFieldName>
            <sourceName>LoyaltyProgramCurrency</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>LoyaltyProgramCurrencyId</primarySourceFieldName>
            <secondarySourceFieldName>Id</secondarySourceFieldName>
        </joinKeys>
        <label>Add Currency Type to Loyalty Member Currency</label>
        <name>LMCPlusLPC</name>
        <primarySourceName>FilterActiveLoyaltyProgramMember</primarySourceName>
        <secondarySourceName>LoyaltyProgramCurrency</secondarySourceName>
        <type>LeftOuter</type>
    </joins>
    <joins>
        <description>Adds the loyalty program name and program currency information to loyalty member currency records.</description>
        <fields>
            <alias>ProgramCurrencyId</alias>
            <sourceFieldName>ProgramCurrencyId</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyMemberId</alias>
            <sourceFieldName>LoyaltyMemberId</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>NextResetDate</alias>
            <sourceFieldName>NextResetDate</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>LastResetDate</alias>
            <sourceFieldName>LastResetDate</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>TotalPointsExpired</alias>
            <sourceFieldName>TotalPointsExpired</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>TotalEscrowRolloverPoints</alias>
            <sourceFieldName>TotalEscrowRolloverPoints</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>TotalPointsAccrued</alias>
            <sourceFieldName>TotalPointsAccrued</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>TotalPointsRedeemed</alias>
            <sourceFieldName>TotalPointsRedeemed</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>BalanceBeforeReset</alias>
            <sourceFieldName>BalanceBeforeReset</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>PointsBalBeforeSecondLastReset</alias>
            <sourceFieldName>PointsBalBeforeSecondLastReset</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>MemberCurrencyId</alias>
            <sourceFieldName>MemberCurrencyId</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyTierGroupId</alias>
            <sourceFieldName>LoyaltyTierGroupId</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>CurrencyType</alias>
            <sourceFieldName>CurrencyType</sourceFieldName>
            <sourceName>LMCPlusLPC</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyProgramName</alias>
            <sourceFieldName>Name</sourceFieldName>
            <sourceName>LoyaltyProgram</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyProgramId</alias>
            <sourceFieldName>Id</sourceFieldName>
            <sourceName>LoyaltyProgram</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>LoyaltyProgramId</primarySourceFieldName>
            <secondarySourceFieldName>Id</secondarySourceFieldName>
        </joinKeys>
        <label>Add Program Name to Loyalty Member Currency</label>
        <name>LMCAndLPCPlusLP</name>
        <primarySourceName>LMCPlusLPC</primarySourceName>
        <secondarySourceName>LoyaltyProgram</secondarySourceName>
        <type>LeftOuter</type>
    </joins>
    <joins>
        <description>Adds the loyalty tier group information to the filtered member currency records.</description>
        <fields>
            <alias>LoyaltyProgramId</alias>
            <sourceFieldName>LoyaltyProgramId</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>ProgramCurrencyId</alias>
            <sourceFieldName>ProgramCurrencyId</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>LoyaltyMemberId</alias>
            <sourceFieldName>LoyaltyMemberId</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>NextResetDate</alias>
            <sourceFieldName>NextResetDate</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>LastResetDate</alias>
            <sourceFieldName>LastResetDate</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>TotalPointsExpired</alias>
            <sourceFieldName>TotalPointsExpired</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>TotalEscrowRolloverPoints</alias>
            <sourceFieldName>TotalEscrowRolloverPoints</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>TotalPointsAccrued</alias>
            <sourceFieldName>TotalPointsAccrued</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>TotalPointsRedeemed</alias>
            <sourceFieldName>TotalPointsRedeemed</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>BalanceBeforeReset</alias>
            <sourceFieldName>BalanceBeforeReset</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>PointsBalBeforeSecondLastReset</alias>
            <sourceFieldName>PointsBalBeforeSecondLastReset</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>MemberCurrencyId</alias>
            <sourceFieldName>MemberCurrencyId</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>CurrencyType</alias>
            <sourceFieldName>CurrencyType</sourceFieldName>
            <sourceName>FilterCurrencyRecordsByProgram</sourceName>
        </fields>
        <fields>
            <alias>TierGroupName</alias>
            <sourceFieldName>Name</sourceFieldName>
            <sourceName>LoyaltyTierGroup</sourceName>
        </fields>
        <fields>
            <alias>QpResetFrequency</alias>
            <sourceFieldName>QpResetFrequency</sourceFieldName>
            <sourceName>LoyaltyTierGroup</sourceName>
        </fields>
        <fields>
            <alias>QpResetPeriod</alias>
            <sourceFieldName>QpResetPeriod</sourceFieldName>
            <sourceName>LoyaltyTierGroup</sourceName>
        </fields>
        <joinKeys>
            <primarySourceFieldName>LoyaltyTierGroupId</primarySourceFieldName>
            <secondarySourceFieldName>Id</secondarySourceFieldName>
        </joinKeys>
        <label>Add Loyalty Tier Group to Member Currency</label>
        <name>FilterMemberCurrencyPlusLPCPlusLTG</name>
        <primarySourceName>FilterCurrencyRecordsByProgram</primarySourceName>
        <secondarySourceName>LoyaltyTierGroup</secondarySourceName>
        <type>LeftOuter</type>
    </joins>
    <label>Club Cloud - Reset Qualifying Points</label>
    <parameters>
        <dataType>Text</dataType>
        <description>The name of the loyalty program.</description>
        <isMultiValue>false</isMultiValue>
        <label>Loyalty Program Name</label>
        <name>LoyaltyProgramName</name>
    </parameters>
    <parameters>
        <dataType>Text</dataType>
        <description>The name of the tier group.</description>
        <isMultiValue>false</isMultiValue>
        <label>Tier Group Name</label>
        <name>TierGroupName</name>
    </parameters>
    <parameters>
        <dataType>Date</dataType>
        <description>Determines the Loyalty Member Currency records to be reset</description>
        <isMultiValue>false</isMultiValue>
        <label>Qualifying Points Reset Date</label>
        <name>QualifyingPointsResetDate</name>
    </parameters>
    <processType>Loyalty</processType>
    <status>Inactive</status>
    <transforms>
        <description>Calculates the current points balance of members based on their accrued, redeemed, expired, and escrowed points.</description>
        <expressionFields>
            <alias>PointsBalance</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>2</decimalPlaces>
            <expression>{TotalPointsAccrued} - {TotalPointsRedeemed} -   {TotalPointsExpired} + {TotalEscrowRolloverPoints}</expression>
            <length>15</length>
        </expressionFields>
        <label>Calculate Members&apos; Points Balance</label>
        <name>CalculateMembersPointsBalance</name>
        <sourceName>CurrencyRecordsToReset</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <transforms>
        <description>Calculates the total expired qualifying points and the next reset date.</description>
        <expressionFields>
            <alias>newExpiredAmount</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>2</decimalPlaces>
            <expression>{PointsBalance} + {TotalPointsExpired}</expression>
            <length>15</length>
        </expressionFields>
        <expressionFields>
            <alias>expiringBalance</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>2</decimalPlaces>
            <expression>{PointsBalance}</expression>
            <length>15</length>
        </expressionFields>
        <expressionFields>
            <alias>LoyaltyMemberCurrencyId</alias>
            <dataType>Text</dataType>
            <expression>{MemberCurrencyId}</expression>
            <length>18</length>
        </expressionFields>
        <expressionFields>
            <alias>newNextResetDate</alias>
            <dataType>Date</dataType>
            <expression>case({QpResetPeriod}, &quot;Years&quot;, ADDMONTHS({NextResetDate}, {QpResetFrequency}*12),&quot;Months&quot;, ADDMONTHS({NextResetDate}, {QpResetFrequency}), ADDDAYS({NextResetDate}, {QpResetFrequency}))</expression>
        </expressionFields>
        <expressionFields>
            <alias>newLastResetDate</alias>
            <dataType>Date</dataType>
            <expression>DATEVALUE({NextResetDate})</expression>
        </expressionFields>
        <expressionFields>
            <alias>newPointsBalBeforeSecondLastReset</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>2</decimalPlaces>
            <expression>{BalanceBeforeReset}</expression>
            <length>15</length>
        </expressionFields>
        <label>Calculate Total Expired Qualifying Points</label>
        <name>CalculateTotalExpiredQualifyingPoints</name>
        <sourceName>CalculateMembersPointsBalance</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <transforms>
        <description>Prepares the data set fields that are used to write back or insert into the transaction journals and ledgers.</description>
        <expressionFields>
            <alias>expiringBalance1</alias>
            <dataType>Numeric</dataType>
            <decimalPlaces>2</decimalPlaces>
            <expression>{PointsBalance}</expression>
            <length>15</length>
        </expressionFields>
        <expressionFields>
            <alias>newEventType</alias>
            <dataType>Text</dataType>
            <expression>&quot;Expiry&quot;</expression>
            <length>10</length>
        </expressionFields>
        <expressionFields>
            <alias>LoyaltyProgramCurrencyid</alias>
            <dataType>Text</dataType>
            <expression>{ProgramCurrencyId}</expression>
            <length>18</length>
        </expressionFields>
        <expressionFields>
            <alias>LoyaltyProgramMemberId</alias>
            <dataType>Text</dataType>
            <expression>{LoyaltyMemberId}</expression>
            <length>18</length>
        </expressionFields>
        <expressionFields>
            <alias>ExternalTransactionNumber</alias>
            <dataType>Text</dataType>
            <expression>CONCAT({MemberCurrencyId}, {$QualifyingPointsResetDate})</expression>
            <length>30</length>
        </expressionFields>
        <expressionFields>
            <alias>Status</alias>
            <dataType>Text</dataType>
            <expression>&quot;Processed&quot;</expression>
            <length>15</length>
        </expressionFields>
        <expressionFields>
            <alias>ActivityDate</alias>
            <dataType>DateTime</dataType>
            <expression>now()</expression>
        </expressionFields>
        <expressionFields>
            <alias>QpResetJournalType</alias>
            <dataType>Text</dataType>
            <expression>&quot;Qualifying Points Reset&quot;</expression>
            <length>30</length>
        </expressionFields>
        <label>Derive Transaction Journal And Loyalty Ledger</label>
        <name>DeriveTransactionJournalAndLoyaltyLedger</name>
        <sourceName>CalculateMembersPointsBalance</sourceName>
        <transformationType>Expression</transformationType>
    </transforms>
    <writebacks>
        <description>Resets qualifying points for members based on the reset date and updates the last reset date and the next reset date in the Loyalty Member Currency records.</description>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>LoyaltyMemberCurrencyId</sourceFieldName>
            <targetFieldName>Id</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>newExpiredAmount</sourceFieldName>
            <targetFieldName>TotalPointsExpired</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>expiringBalance</sourceFieldName>
            <targetFieldName>BalanceBeforeReset</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>newNextResetDate</sourceFieldName>
            <targetFieldName>NextResetDate</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>newLastResetDate</sourceFieldName>
            <targetFieldName>LastResetDate</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>newPointsBalBeforeSecondLastReset</sourceFieldName>
            <targetFieldName>PointsBalBeforeSecondLastReset</targetFieldName>
        </fields>
        <isChangedRow>false</isChangedRow>
        <isExistingDataset>false</isExistingDataset>
        <label>Update Loyalty Member Currency</label>
        <name>UpdateLoyaltyMemberCurrency</name>
        <operationType>Update</operationType>
        <sourceName>CalculateTotalExpiredQualifyingPoints</sourceName>
        <storageType>sObject</storageType>
        <targetObjectName>LoyaltyMemberCurrency</targetObjectName>
        <writebackSequence>3</writebackSequence>
        <writebackUser>005RL00000BBLXRYA5</writebackUser>
    </writebacks>
    <writebacks>
        <description>Creates transaction journals for resetting members points.</description>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>ActivityDate</sourceFieldName>
            <targetFieldName>ActivityDate</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>LoyaltyProgramMemberId</sourceFieldName>
            <targetFieldName>MemberId</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>LoyaltyProgramId</sourceFieldName>
            <targetFieldName>LoyaltyProgramId</targetFieldName>
        </fields>
        <fields>
            <parentName>JournalType</parentName>
            <relationshipName>JournalType</relationshipName>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>QpResetJournalType</sourceFieldName>
            <targetFieldName>Name</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>Status</sourceFieldName>
            <targetFieldName>Status</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>ExternalTransactionNumber</sourceFieldName>
            <targetFieldName>ExternalTransactionNumber</targetFieldName>
        </fields>
        <isChangedRow>false</isChangedRow>
        <isExistingDataset>false</isExistingDataset>
        <label>Create Transaction Journal</label>
        <name>CreateTransactionJournal</name>
        <operationType>Insert</operationType>
        <sourceName>DeriveTransactionJournalAndLoyaltyLedger</sourceName>
        <storageType>sObject</storageType>
        <targetObjectName>TransactionJournal</targetObjectName>
        <writebackSequence>1</writebackSequence>
        <writebackUser>005RL00000BBLXRYA5</writebackUser>
    </writebacks>
    <writebacks>
        <description>Creates loyalty ledgers for resetting members points.</description>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>LoyaltyProgramMemberId</sourceFieldName>
            <targetFieldName>LoyaltyProgramMemberId</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>LoyaltyProgramCurrencyid</sourceFieldName>
            <targetFieldName>LoyaltyProgramCurrencyId</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>ActivityDate</sourceFieldName>
            <targetFieldName>ActivityDate</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>expiringBalance1</sourceFieldName>
            <targetFieldName>Points</targetFieldName>
        </fields>
        <fields>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>newEventType</sourceFieldName>
            <targetFieldName>EventType</targetFieldName>
        </fields>
        <fields>
            <parentName>TransactionJournal</parentName>
            <relationshipName>TransactionJournal</relationshipName>
            <runtimeParameter>false</runtimeParameter>
            <sourceFieldName>ExternalTransactionNumber</sourceFieldName>
            <targetFieldName>ExternalTransactionNumber</targetFieldName>
        </fields>
        <isChangedRow>false</isChangedRow>
        <isExistingDataset>false</isExistingDataset>
        <label>Create Loyalty Ledger</label>
        <name>CreateLoyaltyLedger</name>
        <operationType>Insert</operationType>
        <sourceName>DeriveTransactionJournalAndLoyaltyLedger</sourceName>
        <storageType>sObject</storageType>
        <targetObjectName>LoyaltyLedger</targetObjectName>
        <writebackSequence>2</writebackSequence>
        <writebackUser>005RL00000BBLXRYA5</writebackUser>
    </writebacks>
</BatchCalcJobDefinition>
